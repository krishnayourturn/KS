<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ChatGPT Contra</title>
<style>
html, body { margin:0; padding:0; height:100%; background:#071018; font-family:sans-serif; overflow:hidden; }
canvas { display:block; background:#071018; margin:0 auto; border:2px solid rgba(255,255,255,0.05);}
#controls { position:fixed; bottom:10px; left:0; right:0; display:flex; justify-content:space-between; padding:0 20px; z-index:10; }
.ctrl { width:60px; height:60px; background:rgba(255,255,255,0.05); border-radius:10px; border:1px solid rgba(255,255,255,0.08); display:flex; justify-content:center; align-items:center; font-size:22px; user-select:none; touch-action:none; }
.ctrl.big { width:90px; height:70px; font-size:20px; }
#hud { position:fixed; top:10px; left:10px; z-index:11; color:white; font-weight:bold; }
.panel { background:rgba(0,0,0,0.45); padding:6px 12px; border-radius:6px; margin-right:6px; display:inline-block; }
</style>
</head>
<body>

<canvas id="game" width="1000" height="560"></canvas>

<div id="hud">
  <span class="panel" id="score">Score: 0</span>
  <span class="panel" id="lives">Lives: 3</span>
  <span class="panel" id="level">Level: 1</span>
</div>

<div id="controls">
  <div style="display:flex; gap:10px;">
    <div id="btnLeft" class="ctrl">◀</div>
    <div id="btnRight" class="ctrl">▶</div>
    <div id="btnJump" class="ctrl">▲</div>
  </div>
  <div>
    <div id="btnFire" class="ctrl big">FIRE</div>
  </div>
</div>

<script>
// CANVAS
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
const W = canvas.width, H = canvas.height;

// GAME VARIABLES
let running = false;
let score = 0;
let lives = 3;
let levelIndex = 0;
let cameraX = 0;

// INPUT
const input = {left:false,right:false,jump:false,shoot:false};
function wire(el, prop){
  el.addEventListener('touchstart', e=>{e.preventDefault();input[prop]=true;},{passive:false});
  el.addEventListener('touchend', e=>{e.preventDefault();input[prop]=false;},{passive:false});
  el.addEventListener('mousedown', ()=>input[prop]=true);
  el.addEventListener('mouseup', ()=>input[prop]=false);
  el.addEventListener('mouseleave', ()=>input[prop]=false);
}
wire(document.getElementById('btnLeft'),'left');
wire(document.getElementById('btnRight'),'right');
wire(document.getElementById('btnJump'),'jump');
wire(document.getElementById('btnFire'),'shoot');
window.addEventListener('keydown', e=>{
  if(e.key==='ArrowLeft') input.left=true;
  if(e.key==='ArrowRight') input.right=true;
  if(e.key===' '||e.key==='ArrowUp') input.jump=true;
  if(e.key.toLowerCase()==='z') input.shoot=true;
});
window.addEventListener('keyup', e=>{
  if(e.key==='ArrowLeft') input.left=false;
  if(e.key==='ArrowRight') input.right=false;
  if(e.key===' '||e.key==='ArrowUp') input.jump=false;
  if(e.key.toLowerCase()==='z') input.shoot=false;
});

// PLAYER
const player = {
  x:80, y:H*0.7-60, w:40, h:60,
  vx:0, vy:0, speed:4, onGround:true,
  facing:'right', shootCooldown:0
};

// LEVEL DATA
const levels = [
  {
    width:3000,
    playerStartX:80,
    enemies:[
      {id:1,x:500,patrol:200,type:'grunt',hp:3,shootRange:220},
      {id:2,x:1200,patrol:150,type:'grunt',hp:3,shootRange:220},
      {id:3,x:2000,patrol:250,type:'sniper',hp:2,shootRange:350}
    ],
    levelEndX:2800
  }
];
let level = levels[levelIndex];

// OBJECTS
let bullets=[], enemyBullets=[], enemies=[], particles=[];
const activated = new Set();
const MAX_ACTIVE=3;

// IMAGES
const playerImg = new Image(); playerImg.src='assets/player/Player.PNG';
const enemyImg = new Image(); enemyImg.src='assets/enemies/Enemy.PNG';
const bgImg = new Image(); bgImg.src='assets/background/Background.png';

// UTILS
function clamp(v,a,b){return Math.max(a,Math.min(b,v));}
function rects(a,b){return !(a.x+a.w<b.x||a.x>b.x+b.w||a.y+a.h<b.y||a.y>b.y+b.h);}
function rand(min,max){return Math.floor(Math.random()*(max-min+1))+min;}

// SPAWN ENEMY
function spawnEnemy(cfg){
  const e={
    ...cfg,
    baseX:cfg.x, w:44, h:48,
    vx:(Math.random()<0.5?1:-1)*(0.6+Math.random()*1.2),
    minX:cfg.x-cfg.patrol/2,
    maxX:cfg.x+cfg.patrol/2,
    onGround:true,
    vy:0,
    shootCooldown:rand(40,120)
  };
  e.minX=Math.max(20,e.minX);
  e.maxX=Math.min(level.width-60,e.maxX);
  enemies.push(e);
}

// PLAYER HIT
function hurtPlayer(){
  lives=Math.max(0,lives-1);
  player.x=clamp(player.x-120,20,level.width-60);
  player.vx=player.vy=0;
  if(lives<=0){running=false;setTimeout(()=>alert('Game Over! Score: '+score),50);}
}

// START LEVEL
function startLevel(){
  level = levels[levelIndex];
  player.x=level.playerStartX;
  player.y=H*0.7-60;
  player.vx=player.vy=0;
  bullets=[]; enemyBullets=[]; enemies=[]; particles=[];
  activated.clear();
  score=0;
  lives=3;
  running=true;
}

// UPDATE
function update(){
  if(!running) return;

  // PLAYER
  player.vx=0;
  if(input.left) player.vx=-player.speed,player.facing='left';
  if(input.right) player.vx=player.speed,player.facing='right';
  player.x+=player.vx;
  player.x=clamp(player.x,12,level.width-player.w-12);

  // JUMP
  if(input.jump && player.onGround){player.vy=-11;player.onGround=false;}
  player.vy+=0.6;
  player.y+=player.vy;
  if(player.y+player.h>=H*0.7){player.y=H*0.7-player.h;player.vy=0;player.onGround=true;}

  // CAMERA
  const viewCenter=W*0.38;
  cameraX = clamp(player.x-viewCenter,0,level.width-W);

  // SHOOT
  if(input.shoot && player.shootCooldown<=0){
    const dir = player.facing==='right'?1:-1;
    bullets.push({x:player.x + (dir===1?player.w-4:-12), y:player.y+player.h*0.45, vx:12*dir,w:10,h:5,life:200});
    player.shootCooldown=12;
  }
  if(player.shootCooldown>0) player.shootCooldown--;

  // SPAWN ENEMIES
  for(const cfg of level.enemies){
    if(activated.has(cfg.id)) continue;
    if(player.x>=cfg.x-100 && enemies.length<MAX_ACTIVE){
      spawnEnemy(cfg);
      activated.add(cfg.id);
    }
  }

  // ENEMIES
  for(let i=enemies.length-1;i>=0;i--){
    const e=enemies[i];
    e.x+=e.vx;
    if(e.x<e.minX){e.x=e.minX;e.vx=Math.abs(e.vx);}
    if(e.x+e.w>e.maxX){e.x=e.maxX-e.w;e.vx=-Math.abs(e.vx);}
    // ENEMY SHOOT
    const dx = player.x-e.x;
    if(Math.abs(dx)<=e.shootRange && e.shootCooldown<=0){
      const dir=dx>=0?1:-1;
      enemyBullets.push({x:e.x+e.w/2,y:e.y+e.h/2,vx:5*dir,vy:0,w:8,h:6,life:300});
      e.shootCooldown=60+Math.floor(Math.random()*60);
    }
    if(e.shootCooldown>0) e.shootCooldown--;

    if(e.hp<=0){enemies.splice(i,1);score+=40;}
  }

  // PLAYER BULLETS
  for(let i=bullets.length-1;i>=0;i--){
    const b=bullets[i]; b.x+=b.vx;b.life--;
    if(b.life<=0){bullets.splice(i,1);continue;}
    for(let j=enemies.length-1;j>=0;j--){
      if(rects(b,enemies[j])){enemies[j].hp--; bullets.splice(i,1); break;}
    }
  }

  // ENEMY BULLETS
  for(let i=enemyBullets.length-1;i>=0;i--){
    const b=enemyBullets[i]; b.x+=b.vx;b.life--;
    if(b.life<=0) enemyBullets.splice(i,1);
    else if(rects(b,player)){enemyBullets.splice(i,1);hurtPlayer();}
  }
}

// RENDER
function render(){
  ctx.clearRect(0,0,W,H);

  // BACKGROUND
  if(bgImg.complete) ctx.drawImage(bgImg,-cameraX,0,level.width,H);

  // GROUND
  ctx.fillStyle='#0f2a2a';
  ctx.fillRect(0,H*0.7,W,H*0.7);

  // ENEMIES
  for(const e of enemies){
    if(enemyImg.complete) ctx.drawImage(enemyImg,e.x-cameraX,e.y,e.w,e.h);
    else {ctx.fillStyle='red';ctx.fillRect(e.x-cameraX,e.y,e.w,e.h);}
  }

  // PLAYER
  if(playerImg.complete) ctx.drawImage(playerImg,player.x-cameraX,player.y,player.w,player.h);
  else ctx.fillStyle='lime',ctx.fillRect(player.x-cameraX,player.y,player.w,player.h);

  // BULLETS
  ctx.fillStyle='yellow';
  for(const b of bullets) ctx.fillRect(b.x-cameraX,b.y,b.w,b.h);
  ctx.fillStyle='orange';
  for(const b of enemyBullets) ctx.fillRect(b.x-cameraX,b.y,b.w,b.h);
}

// GAME LOOP
function loop(){
  update();
  render();
  requestAnimationFrame(loop);
}

// START
startLevel();
loop();
</script>
</body>
</html>
