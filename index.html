<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Shakrit — playable</title>
<style>
  html, body {
    margin: 0;
    padding: 0;
    height: 100%;
    background: #071018;
    color: #fff;
    font-family: Arial, Helvetica, sans-serif;
  }
  #title {
    position: fixed;
    inset: 0;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    z-index: 60;
    background: linear-gradient(#000,#071016);
  }
  #title h1 {
    margin: 0;
    font-size: 56px;
    color: #00ff99;
    text-shadow: 0 6px 18px rgba(0,0,0,0.8);
  }
  .btn {
    padding: 12px 22px;
    margin: 8px;
    border-radius: 8px;
    border: 0;
    background: #0b6;
    cursor: pointer;
    font-weight: 700;
  }
  #canvasWrap {
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    box-sizing: border-box;
    padding: 12px;
  }
  canvas {
    border: 3px solid rgba(255,255,255,0.04);
    max-width: 100%;
    height: auto;
    display: block;
    background-size: cover;
    background-position: bottom;
  }
  #controls {
    position: fixed;
    left: 0;
    right: 0;
    bottom: 12px;
    display: flex;
    justify-content: space-between;
    padding: 0 20px;
    z-index: 70;
    pointer-events: none;
  }
  .leftControls, .rightControls {
    display: flex;
    gap: 10px;
    pointer-events: auto;
  }
  .ctrl {
    width: 64px;
    height: 64px;
    border-radius: 12px;
    background: rgba(255,255,255,0.03);
    border: 1px solid rgba(255,255,255,0.06);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 22px;
    user-select: none;
    touch-action: none;
  }
  .ctrl.big { width: 92px; height: 72px; }
  #hud {
    position: fixed;
    left: 12px;
    top: 12px;
    display: flex;
    gap: 12px;
    z-index: 75;
  }
  .panel {
    background: rgba(0,0,0,0.45);
    padding: 8px 12px;
    border-radius: 8px;
    border: 1px solid rgba(255,255,255,0.03);
    font-weight: 700;
  }
  @media(max-width:600px){ 
    .ctrl { width: 52px; height: 52px; font-size: 18px; } 
    .ctrl.big { width: 84px; height: 64px; } 
    #title h1{ font-size:36px; } 
  }
</style>
</head>
<body>

<!-- Title -->
<div id="title">
  <h1>Shakrit</h1>
  <div style="margin:8px;color:#9fb">Side-scroller Prototype — touch or keyboard</div>
  <div>
    <button id="startBtn" class="btn">Start Game</button>
    <button id="settingsBtn" class="btn" style="background:#448">Settings</button>
  </div>
  <div style="margin-top:6px;color:#9fb;font-size:13px">Controls: ← → move, Space jump, Z shoot; touch buttons below</div>
</div>

<!-- HUD -->
<div id="hud" aria-hidden>
  <div class="panel" id="score">Score: 0</div>
  <div class="panel" id="lives">Lives: 3</div>
  <div class="panel" id="level">Level: 1</div>
</div>

<!-- Canvas -->
<div id="canvasWrap">
  <canvas id="game" width="1000" height="560"></canvas>
</div>

<!-- Touch Controls -->
<div id="controls">
  <div class="leftControls">
    <div id="btnLeft" class="ctrl">◀</div>
    <div id="btnRight" class="ctrl">▶</div>
    <div id="btnJump" class="ctrl">▲</div>
  </div>
  <div class="rightControls">
    <div id="btnFire" class="ctrl big">FIRE</div>
  </div>
</div>

<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
const W = canvas.width, H = canvas.height;

const startBtn = document.getElementById('startBtn');
const title = document.getElementById('title');
const scoreDOM = document.getElementById('score');
const livesDOM = document.getElementById('lives');
const levelDOM = document.getElementById('level');

const controls = {
  left: document.getElementById('btnLeft'),
  right: document.getElementById('btnRight'),
  jump: document.getElementById('btnJump'),
  fire: document.getElementById('btnFire')
};

let running = false;
let paused = false;

const LEVEL_HEIGHT_RATIO = 0.3; // Player 30% above bottom
const GROUND_HEIGHT = H * LEVEL_HEIGHT_RATIO;

let levelIndex = 0;
const levels = [
  {
    width: 4000,
    playerStartX: 80,
    enemies: [
      {x:600, type:'grunt', hp:2},
      {x:1200, type:'grunt', hp:2},
      {x:1800, type:'jumper', hp:3},
      {x:2600, type:'sniper', hp:2},
      {x:3400, type:'grunt', hp:2}
    ],
    levelEndX: 3800
  }
];

let levelData = levels[levelIndex];
let levelWidth = levelData.width;

let cameraX = 0;

// Player
const player = {
  x: 80, y: H - GROUND_HEIGHT - 60,
  w:40, h:60,
  vx:0, vy:0,
  speed:4,
  onGround:true,
  facing:'right',
  shootCooldown:0
};

let bullets = [];
let enemyBullets = [];
let enemies = [];
let particles = [];
let score = 0, lives = 3;

// Utils
function clamp(v,a,b){ return Math.max(a,Math.min(b,v)); }
function rand(min,max){ return Math.floor(Math.random()*(max-min+1))+min; }
function rects(a,b){ return !(a.x+a.w < b.x || a.x > b.x+b.w || a.y+a.h < b.y || a.y > b.y + b.h); }

// Input
const input = {left:false, right:false, jump:false, shoot:false};
window.addEventListener('keydown',e=>{
  if(e.key==='ArrowLeft') input.left=true,player.facing='left';
  if(e.key==='ArrowRight') input.right=true,player.facing='right';
  if(e.key===' '||e.key==='ArrowUp') input.jump=true;
  if(e.key.toLowerCase()==='z') input.shoot=true;
});
window.addEventListener('keyup',e=>{
  if(e.key==='ArrowLeft') input.left=false;
  if(e.key==='ArrowRight') input.right=false;
  if(e.key===' '||e.key==='ArrowUp') input.jump=false;
  if(e.key.toLowerCase()==='z') input.shoot=false;
});

// Touch
function wire(el,prop){
  el.addEventListener('touchstart',ev=>{ ev.preventDefault(); input[prop]=true;},{passive:false});
  el.addEventListener('touchend',ev=>{ ev.preventDefault(); input[prop]=false;},{passive:false});
  el.addEventListener('mousedown',()=>input[prop]=true);
  el.addEventListener('mouseup',()=>input[prop]=false);
  el.addEventListener('mouseleave',()=>input[prop]=false);
}
wire(controls.left,'left'); wire(controls.right,'right'); wire(controls.jump,'jump'); wire(controls.fire,'shoot');

// Level setup
function spawnEnemies(){
  enemies.length=0;
  for(const cfg of levelData.enemies){
    enemies.push({
      x: cfg.x,
      y: H - GROUND_HEIGHT - 40,
      w:30,
      h:40,
      vx:(Math.random()<0.5?1:-1)*1,
      hp: cfg.hp,
      type: cfg.type,
      shootCooldown: rand(60,120)
    });
  }
}

function update(){
  player.vx=0;
  if(input.left) player.vx=-player.speed;
  if(input.right) player.vx=player.speed;
  player.x+=player.vx;

  const viewCenter=W*0.38;
  cameraX=clamp(player.x-viewCenter,0,levelWidth-W);

  if(input.jump && player.onGround){ player.vy=-12; player.onGround=false; }
  player.vy+=0.6;
  player.y+=player.vy;
  if(player.y + player.h >= H - GROUND_HEIGHT){ player.y=H - GROUND_HEIGHT - player.h; player.vy=0; player.onGround=true; }

  if(input.shoot && player.shootCooldown<=0){
    const dir=player.facing==='right'?1:-1;
    bullets.push({x:player.x + (dir===1?player.w: -12), y:player.y+player.h*0.45, vx:12*dir, w:10,h:5,life:200});
    player.shootCooldown=12;
  }
  if(player.shootCooldown>0) player.shootCooldown--;

  // Enemy logic
  for(let i=enemies.length-1;i>=0;i--){
    const e=enemies[i];
    e.x+=e.vx;
    if(e.x<20){ e.x=20; e.vx=Math.abs(e.vx);}
    if(e.x+e.w>levelWidth-20){ e.x=levelWidth-e.w-20; e.vx=-Math.abs(e.vx); }

    e.shootCooldown--;
    if(e.shootCooldown<=0){
      const dx=player.x - e.x;
      if(Math.abs(dx)<300){
        const dir=dx>0?1:-1;
        enemyBullets.push({x:e.x+e.w/2,y:e.y+e.h/2,vx:5*dir,vy:0,w:8,h:6,life:300});
      }
      e.shootCooldown=rand(60,120);
    }

    if(e.hp<=0){ enemies.splice(i,1); score+=40; }
  }

  // Bullets collision
  for(let i=bullets.length-1;i>=0;i--){
    const b=bullets[i]; b.x+=b.vx; b.life--;
    if(b.life<=0){ bullets.splice(i,1); continue; }
    for(let j=enemies.length-1;j>=0;j--){
      if(rects(b,enemies[j])){ enemies[j].hp-=1; bullets.splice(i,1); break; }
    }
  }

  for(let i=enemyBullets.length-1;i>=0;i--){
    const b=enemyBullets[i]; b.x+=b.vx; b.life--;
    if(b.life<=0){ enemyBullets.splice(i,1); continue; }
    if(rects(b,player)){ enemyBullets.splice(i,1); hurtPlayer(); }
  }

  scoreDOM.textContent='Score: '+score;
  livesDOM.textContent='Lives: '+lives;
  levelDOM.textContent='Level: '+(levelIndex+1);

  if(player.x>=levelData.levelEndX){
    running=false;
    setTimeout(()=>alert('You finished the game! Score: '+score),50);
    resetAndShowTitle();
  }
}

function spawnExplosion(x,y){
  for(let i=0;i<12;i++){
    particles.push({
      x:x+rand(-8,8),y:y+rand(-8,8),
      vx:(Math.random()-0.5)*6, vy:(Math.random()-0.5)*6-1,
      life:20+rand(0,30),
      col:['#ff9a6b','#ff6b6b','#ffd24d'][rand(0,2)]
    });
  }
}

function hurtPlayer(){
  lives=Math.max(0,lives-1);
  spawnExplosion(player.x,player.y);
  player.x=80; player.vx=0; player.vy=0;
  if(lives===0){ running=false; setTimeout(()=>alert('Game Over! Score: '+score),50); resetAndShowTitle(); }
}

// Render
function render(){
  ctx.clearRect(0,0,W,H);

  // Background image
  canvas.style.backgroundImage="url('assets/background/Background.png')";

  // Ground line
  ctx.fillStyle='#0f2a2a';
  ctx.fillRect(0,H-GROUND_HEIGHT,W,GROUND_HEIGHT);

  // Player - designed human
  drawPlayer(player.x-cameraX,player.y,player.w,player.h,player.facing);

  // Enemy - smaller human
  for(const e of enemies) drawEnemy(e.x-cameraX,e.y,e.w,e.h);

  // Bullets
  ctx.fillStyle='#ffd24d'; for(const b of bullets) ctx.fillRect(b.x-cameraX,b.y,b.w,b.h);
  ctx.fillStyle='#ff7b7b'; for(const b of enemyBullets) ctx.fillRect(b.x-cameraX,b.y,b.w,b.h);
}

// Draw custom player
function drawPlayer(sx,sy,w,h,facing){
  ctx.save();
  if(facing==='left'){ ctx.translate(sx+w/2,0); ctx.scale(-1,1); sx=-sx; }
  // Body
  ctx.fillStyle='#06b07a'; ctx.fillRect(sx,sy,w,h);
  // Head
  ctx.fillStyle='#0ff'; ctx.fillRect(sx+w*0.25,sy-10,w*0.5,h*0.25);
  ctx.restore();
}

// Draw enemy
function drawEnemy(sx,sy,w,h){
  ctx.fillStyle='#ff3333'; ctx.fillRect(sx,sy,w,h);
  ctx.fillStyle='#880000'; ctx.fillRect(sx+w*0.2,sy-6,w*0.6,h*0.15);
}

// Main loop
let lastTs=0;
function step(ts){
  if(!lastTs) lastTs=ts;
  const dt=(ts-lastTs)/16.666;
  lastTs=ts;
  if(running && !paused){ update(); render(); }
  requestAnimationFrame(step);
}

function startLevel(index){
  levelIndex=index;
  levelData=levels[levelIndex];
  levelWidth=levelData.width;
  enemies.length=0; bullets.length=0; enemyBullets.length=0; particles.length=0;
  player.x=levelData.playerStartX; player.y=H-GROUND_HEIGHT-player.h; player.vx=0; player.vy=0; player.onGround=true; player.shootCooldown=0;
  score=0; lives=3;
  running=true;
  title.style.display='none';
  spawnEnemies();
}

function resetAndShowTitle(){
  running=false;
  title.style.display='flex';
}

startBtn.addEventListener('click',()=>startLevel(0));
document.getElementById('settingsBtn').addEventListener('click',()=>alert('Settings: none'));

resetAndShowTitle();
requestAnimationFrame(step);
</script>
</body>
</html>
